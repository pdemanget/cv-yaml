<!DOCTYPE html>
<html lang=fr><head>
<meta charset="UTF-8">	
<title>CV</title>


<script src="../node_modules/bjs/dist/b.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.10.0/js-yaml.min.js"></script>
<script>
	
/**
 * convert yaml to object
 */
var yhr=function(txt){
	return jsyaml.load(txt);
};
extend=function(me,o){
	for(k in o){
		me[k]=o[k];
	}
};


async function loadBplugin(b) {
  b.filters.set("json",JSON.stringify);
}

async function loadBready(b) {
    // do the await things here.
  

      // b is an instance of BJS
      
      cvResponse = await fetch("data/cv-example.yaml");
      cvBody = await cvResponse.text();
      cv = yhr(cvBody);
      //flatten skillarray
      cv.skillArray=[];
      for(skill of cv.skills){
        for(key in skill){
          cv.skillArray.push({key:key,value:skill[key]});
        }
      }
      // extend(b.scope,cv);
      b.scope.cv=cv;
      
      console.debug(JSON.stringify( b.scope,null,2));
}

document.addEventListener('bplugin', (event) => loadBplugin(event.detail));
document.addEventListener('bready', (event) => loadBready(event.detail));



</script>
<style>
/* 6 paragraphes: titles profile skills  formation languages missions titre #003567 texte #58585A bullets #547CA9 mission*/
@page {
 /* size: A4;*/
  size: A4;
  margin: 0;
}
@media print {
  html, body {
    width: 210mm;
    height: 297mm;
  }
  body 
    {
        background-color:#FFFFFF; 
        border: solid 1px black ;
        margin: 0px;  /* this affects the margin on the content before sending to printer */
   }
}
/* TODO gestion de l'impression */
    @media screen {
		/*div.footer {
			/*display: none;*/
			background-image: url("style/footer.png");
			background-repeat: no-repeat;
			background-origin: border-box;
			background-size: contain;
			position: fixed;
			bottom: 0;
			width: 210mm;
			height: 12mm;
		}*/
    }
    @media print {
		div.footer {
			/*display: none;*/
			background-image: url("style/footer.png");
			background-repeat: no-repeat;
			background-origin: border-box;
			background-size: contain;
			position: fixed;
			bottom: 0;
			width: 210mm;
			height: 12mm;
/*			background-position: 0px 0px,
                         center;*/
			-webkit-print-color-adjust: exact;
		} 
		.page{
			background-color: white !important;
		}
	}
	
.two-columns{
	column-count: 2;
	column-gap: 15px;
	-webkit-column-count: 2;
	-webkit-column-gap: 15px;
	-moz-column-count: 2;
	-moz-column-gap: 15px;

	/* column-rule: 3px outset #ff00ff;*/
}

/* ... the rest of the rules ... */
html{
   width: 210mm;
   height: 297mm;
   	-webkit-print-color-adjust: exact;
}
body{
	font-size:15px;
	font-weight: normal;
	font-family: sans-serif;
    background-image: url("style/header.png");
    background-repeat: no-repeat;
    background-size: 12cm 4cm;
    background-origin: content-box;
    width: 210mm;
    height: 297mm;
	color: #58585A;
	padding: 150px 50px 50px 100px;
	/* trick pour imprimer les bulles */
	-webkit-print-color-adjust: exact;
/* a essayer
	background-color: white !important;
	box-shadow: inset 0 0 0 1000px gold;

p:before { content: url(images/quote.gif); }
*/	
}
.titles {
	text-align:right;
}
.titles h1{
	font-size: 20px;
}
.titles h2{
	font-size: 20px;
	margin: 5px;
}

.name{
	font-size:30px;
	font-weight: bold;
	color: #003567;
}
h1{
	font-size:30px;
	color: #003567;
	text-transform: uppercase;
	border-bottom: 1px solid #003567;
}


h3{
	color: #7F7F7F;
}

.skills::first-child h2{
	margin-top: 0;
}

.experience h2{
	color: #547CA9;
}

ul {
    list-style-type: none;
    padding: 0px;
    margin: 0px;
}

ul li {
    background-image: url('style/bullet2.png');
    background-repeat: no-repeat;
    background-position: 0px 0px; 
    padding-left: 30px; 
}
p {
	margin: 5px;
}

.formation{
	float: left;
	width: 60%;
}

.formation h2{
	margin: 2px;
}

.formation h3{
	margin: 2px;
}
.lang{
	
}
.experiences{
	clear: both;
	break-before: always;
}
.experiences{
	break-before: auto;
	break-inside: avoid;
}
.chrono{
	clear: both;
	break-before: auto;
	page-break-before: always
}
/*
a:link,
a:visited ,
a:hover,
a:active,
a {
	font-color:#555;
}*/

.chrono .mission{
	clear: both;
	float: left;
}
.chrono a:link{
	color: #003567;
	text-decoration: none;
	white-space: nowrap
}	
.chrono div .keywords{
	position: relative;
	/*clear: both;*/
	white-space: nowrap;
	float: right;
	font-size:0.8em;
	color:#555;
}
</style>
</head><body>
<noscript>Javascript not started</noscript>
<div>

<!--<img src="style/header.png">-->
<!-- inclusion des balises du CV-->
<div class="titles">
 <span class="name"><span bval="cv.firstname"></span> <span bval="cv.lastname"></span></span>
 <h2 bfor="cv.titles"><span bval="$value"/></h2>
</div>
<div class="profile">
 
 <h1>Profil</h1>
 <ul><li bfor="cv.profile"><span bval="$value"/></li></ul>
</div>

<div class="skills">
 <h1>Compétences Techniques et Fonctionnelles</h1>
 <div class="two-columns">
  <div bfor="cv.skillArray" >
    <div class="skill"  contenteditable="true" >
     <h2><span bval="$value.key" /></h2>
     <ul><li bfor="$value.value" contenteditable="true" ><span bval="$value"/></li></ul>
   </div>
  </div>
 </div>
</div>

<div class="formation">
	<h1>Formations</h1>
	<ul><li bfor="cv.formations">
		<h2><span bval="$value.year"/></h2><h3><span bval="$value.title"/></h3><span bval="$value.school"/>
	</li></ul>	
</div>
<div class="lang">
	<h1>Langues</h1>
	<ul><li bfor="cv.languages"><span bval="$value"/></li></ul>	
</div>

<div class="chrono">
	<h1>Chronogramme</h1>
	<div  bfor="cv.experience">
		<div class="mission"><a  href="#exp{{$index}}"> <span bval="$value.year"></span><span bval="$value.duration"></span>- <span bval="$value.role.title"></span> - <span bval="$value.enterprise"/>
		- <span bval="exp.project.title"></span> </a></div>
		<div class="keywords"><span bval="$value.environment"/></div>
		<span bbval="$value|json"></span>
	</div>
	<br>
</div>

<div class="experiences">
	<h1>Missions- Projets</h1>
	<div id="exp{{$index}}" bfor="cv.experience" class="experience">
		<h2><span bval="$value.enterprise"></span> - <span bval="$value.project.title"></span></h2>
		<ul>
			<li><b>Durée : </b><span bval="$value.duration"></span></li>
			<li><b>Projet : </b><br><span bval="$value.project.description"></span></li>
			<li><b>Rôle : </b><span bval="$value.role.title"></span><br>
			
				<p bfor="$value.role.description"><span bval="$value.desc"></span></p>
			</li>
			<li><b>Équipe : </b><span bval="$value.team"></span></li>
			<li><b>Environnement Technique: </b><span bval="$value.environment"></span></li>
		</ul>
	</div>
</div>

<div class="footer">
<span bbval="cv|json"></span>
</div>
</body></html>
